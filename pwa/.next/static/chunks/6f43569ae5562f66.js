(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,65756,e=>{"use strict";var a=e.i(74907);let t=e=>{let a=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,a,t)=>t?t.toUpperCase():a.toLowerCase());return a.charAt(0).toUpperCase()+a.slice(1)},r=(...e)=>e.filter((e,a,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===a).join(" ").trim();var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:n,className:l="",children:d,iconNode:c,...o},u)=>(0,a.createElement)("svg",{ref:u,...s,width:t,height:t,stroke:e,strokeWidth:n?24*Number(i)/Number(t):i,className:r("lucide",l),...!d&&!(e=>{for(let a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0})(o)&&{"aria-hidden":"true"},...o},[...c.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(d)?d:[d]])),n=(e,s)=>{let n=(0,a.forwardRef)(({className:n,...l},d)=>(0,a.createElement)(i,{ref:d,iconNode:s,className:r(`lucide-${t(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...l}));return n.displayName=t(e),n};e.s(["default",()=>n],65756)},23941,e=>{"use strict";var a=e.i(73444),t=e.i(75784),r=e.i(51176),s=e.i(67830);let i=(0,r.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let r,n,l,d,c,o=(0,t.c)(10);return o[0]!==e?({className:r,variant:l,...n}=e,o[0]=e,o[1]=r,o[2]=n,o[3]=l):(r=o[1],n=o[2],l=o[3]),o[4]!==r||o[5]!==l?(d=(0,s.cn)(i({variant:l}),r),o[4]=r,o[5]=l,o[6]=d):d=o[6],o[7]!==n||o[8]!==d?(c=(0,a.jsx)("div",{className:d,...n}),o[7]=n,o[8]=d,o[9]=c):c=o[9],c}e.s(["Badge",()=>n])},9718,e=>{"use strict";var a=e.i(73444),t=e.i(75784),r=e.i(74907),s=e.i(7272),i=e.i(12286),n=e.i(63835),l=e.i(65756);let d=(0,l.default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),c=(0,l.default)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),o=(0,l.default)("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),u=(0,l.default)("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]),h=(0,l.default)("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);var m=e.i(23941);function x(){let{db:t}=(0,s.useDatabaseStore)(),[l,x]=(0,r.useState)(!1),[f,v]=(0,r.useState)(0),[y,p]=(0,r.useState)([]),[w,b]=(0,r.useState)([]),[g,j]=(0,r.useState)(null);(0,r.useEffect)(()=>{!async function(){try{if(t){window.testDb=t;let{Database:a}=await e.A(61419);window.Database=a;return}let a=(await e.A(61419)).default,{Database:r}=await e.A(61419);await a(),window.Database=r}catch(e){console.error("Failed to initialize WASM:",e)}}()},[t]);let N=e=>0===e?"0 bytes":e<1024?`${e} bytes`:e<1048576?`${(e/1024).toFixed(2)} KB`:e<0x40000000?`${(e/1048576).toFixed(2)} MB`:`${(e/0x40000000).toFixed(2)} GB`,C=async()=>{try{if(!t)return 4096;let e=await t.execute("PRAGMA page_size");if(e.rows&&e.rows.length>0)return e.rows[0].values[0].value;return 4096}catch(e){return 4096}},k=async e=>{try{if(!t)return 0;await C();let a=await t.execute(`SELECT SUM(pgsize) as size FROM dbstat WHERE name='${e}'`);if(a.rows&&a.rows.length>0){let e=a.rows[0].values[0];if(e.value)return e.value}let r=await t.execute(`SELECT COUNT(*) as count FROM ${e}`);if(r.rows&&r.rows.length>0){let e=r.rows[0].values[0].value;return 100*e}return 0}catch(a){try{let a=await t.execute(`SELECT COUNT(*) as count FROM ${e}`);if(a.rows&&a.rows.length>0){let e=a.rows[0].values[0].value;return 100*e}}catch(e){}return 0}},E=async e=>{try{if(!t)return 0;let a=await t.execute(`SELECT SUM(pgsize) as size FROM dbstat WHERE name='${e}'`);if(a.rows&&a.rows.length>0){let e=a.rows[0].values[0];if(e.value)return e.value}return 1024}catch(e){return 1024}},M=(0,r.useCallback)(async()=>{if(!t)return void j("No database connected");x(!0),j(null);try{let e=(await t.execute("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%'")).rows.map(async e=>{let a=e.values[0].value,r=(await t.execute(`SELECT COUNT(*) as count FROM ${a}`)).rows[0].values[0].value,s=await k(a);return{name:a,rowCount:r,size:s}}),a=await Promise.all(e);p(a);let r=(await t.execute("SELECT name, tbl_name FROM sqlite_master WHERE type='index' AND name NOT LIKE 'sqlite_%'")).rows.map(async e=>{let a=e.values[0].value,t=e.values[1].value,r=await E(a);return{name:a,tableName:t,size:r}}),s=await Promise.all(r);b(s);let i=a.reduce((e,a)=>e+a.size,0),n=s.reduce((e,a)=>e+a.size,0),l=i+n;v(l>0?l:8192)}catch(e){j(e instanceof Error?e.message:"Failed to load storage information")}finally{x(!1)}},[t]);return((0,r.useEffect)(()=>{t&&M()},[t]),g)?(0,a.jsx)("div",{className:"container mx-auto p-6",children:(0,a.jsxs)(i.Card,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(i.CardHeader,{children:(0,a.jsx)(i.CardTitle,{className:"text-red-700",children:"Error"})}),(0,a.jsx)(i.CardContent,{children:(0,a.jsx)("p",{className:"text-red-600",children:g})})]})}):(0,a.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Storage Analysis"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Analyze database storage usage and optimize performance"})]}),(0,a.jsxs)(n.Button,{id:"refreshStorageButton",onClick:()=>{M()},disabled:l,variant:"outline",children:[(0,a.jsx)(d,{className:`mr-2 h-4 w-4 ${l?"animate-spin":""}`}),"Refresh"]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(c,{className:"h-5 w-5"}),"Database Size"]}),(0,a.jsx)(i.CardDescription,{children:"Total storage used by the database"})]}),(0,a.jsx)(i.CardContent,{children:(0,a.jsx)("div",{className:"text-4xl font-bold","data-testid":"db-size",children:N(f)})})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o,{className:"h-5 w-5"}),"Tables"]}),(0,a.jsx)(i.CardDescription,{children:"Storage breakdown by table"})]}),(0,a.jsx)(i.CardContent,{children:0===y.length?(0,a.jsx)("p",{className:"text-muted-foreground",children:"No tables found in this database."}):(0,a.jsx)("div",{className:"space-y-4",children:y.map(e=>(0,a.jsxs)("div",{"data-table":e.name,"data-table-name":e.name,className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.rowCount," ",1===e.rowCount?"row":"rows"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-medium table-size","data-testid":"table-size",children:N(e.size)}),(0,a.jsxs)(m.Badge,{variant:"secondary",className:"mt-1",children:[(0,a.jsx)(h,{className:"h-3 w-3 mr-1"}),"Table"]})]})]},e.name))})})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(u,{className:"h-5 w-5"}),"Indexes"]}),(0,a.jsx)(i.CardDescription,{children:"Storage used by indexes"})]}),(0,a.jsx)(i.CardContent,{children:0===w.length?(0,a.jsx)("p",{className:"text-muted-foreground",children:"No indexes found in this database."}):(0,a.jsx)("div",{className:"space-y-4",children:w.map(e=>(0,a.jsxs)("div",{"data-index":e.name,className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["on table: ",e.tableName]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-medium index-size","data-testid":"index-size",children:N(e.size)}),(0,a.jsxs)(m.Badge,{variant:"secondary",className:"mt-1",children:[(0,a.jsx)(u,{className:"h-3 w-3 mr-1"}),"Index"]})]})]},e.name))})})]})]})}function f(){let e,r=(0,t.c)(2);if(!(0,s.useDatabaseStore)(v)){let e;return r[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,a.jsx)("div",{className:"container mx-auto p-8",children:(0,a.jsx)("div",{className:"text-center text-gray-600",children:"No database selected. Please create or open a database first."})}),r[0]=e):e=r[0],e}return r[1]===Symbol.for("react.memo_cache_sentinel")?(e=(0,a.jsx)(x,{}),r[1]=e):e=r[1],e}function v(e){return e.currentDbName}e.s(["default",()=>f],9718)},61419,e=>{e.v(a=>Promise.all(["static/chunks/0d126131a3369877.js"].map(a=>e.l(a))).then(()=>a(4948)))}]);