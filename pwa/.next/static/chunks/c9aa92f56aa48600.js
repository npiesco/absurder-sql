(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,65756,e=>{"use strict";var a=e.i(74907);let t=e=>{let a=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,a,t)=>t?t.toUpperCase():a.toLowerCase());return a.charAt(0).toUpperCase()+a.slice(1)},s=(...e)=>e.filter((e,a,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===a).join(" ").trim();var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:l=2,absoluteStrokeWidth:d,className:n="",children:i,iconNode:o,...c},m)=>(0,a.createElement)("svg",{ref:m,...r,width:t,height:t,stroke:e,strokeWidth:d?24*Number(l)/Number(t):l,className:s("lucide",n),...!i&&!(e=>{for(let a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0})(c)&&{"aria-hidden":"true"},...c},[...o.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(i)?i:[i]])),d=(e,r)=>{let d=(0,a.forwardRef)(({className:d,...n},i)=>(0,a.createElement)(l,{ref:i,iconNode:r,className:s(`lucide-${t(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,d),...n}));return d.displayName=t(e),d};e.s(["default",()=>d],65756)},23941,e=>{"use strict";var a=e.i(73444),t=e.i(75784),s=e.i(51176),r=e.i(67830);let l=(0,s.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function d(e){let s,d,n,i,o,c=(0,t.c)(10);return c[0]!==e?({className:s,variant:n,...d}=e,c[0]=e,c[1]=s,c[2]=d,c[3]=n):(s=c[1],d=c[2],n=c[3]),c[4]!==s||c[5]!==n?(i=(0,r.cn)(l({variant:n}),s),c[4]=s,c[5]=n,c[6]=i):i=c[6],c[7]!==d||c[8]!==i?(o=(0,a.jsx)("div",{className:i,...d}),c[7]=d,c[8]=i,c[9]=o):o=c[9],o}e.s(["Badge",()=>d])},45029,e=>{"use strict";var a=e.i(73444),t=e.i(75784),s=e.i(51176),r=e.i(67830);let l=(0,s.cva)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function d(e){let s,d,n,i,o,c=(0,t.c)(10);return c[0]!==e?({className:s,variant:n,...d}=e,c[0]=e,c[1]=s,c[2]=d,c[3]=n):(s=c[1],d=c[2],n=c[3]),c[4]!==s||c[5]!==n?(i=(0,r.cn)(l({variant:n}),s),c[4]=s,c[5]=n,c[6]=i):i=c[6],c[7]!==d||c[8]!==i?(o=(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:i,...d}),c[7]=d,c[8]=i,c[9]=o):o=c[9],o}function n(e){let s,l,d,n,i=(0,t.c)(8);return i[0]!==e?({className:s,...l}=e,i[0]=e,i[1]=s,i[2]=l):(s=i[1],l=i[2]),i[3]!==s?(d=(0,r.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),i[3]=s,i[4]=d):d=i[4],i[5]!==l||i[6]!==d?(n=(0,a.jsx)("div",{"data-slot":"alert-description",className:d,...l}),i[5]=l,i[6]=d,i[7]=n):n=i[7],n}e.s(["Alert",()=>d,"AlertDescription",()=>n])},51752,e=>{"use strict";var a=e.i(73444),t=e.i(75784),s=e.i(74907),r=e.i(7272),l=e.i(63835),d=e.i(12286),n=e.i(72667),i=e.i(45029),o=e.i(23941);function c(){let{db:t}=(0,r.useDatabaseStore)(),[c,m]=(0,s.useState)([]),[u,h]=(0,s.useState)(""),[x,g]=(0,s.useState)(""),[p,f]=(0,s.useState)(null),[v,b]=(0,s.useState)(!1),[j,w]=(0,s.useState)(null),[N,C]=(0,s.useState)(!1),[R,y]=(0,s.useState)(""),[A,E]=(0,s.useState)(""),[S,D]=(0,s.useState)(!1),[T,$]=(0,s.useState)(!1);(0,s.useEffect)(()=>{window.Database?C(!0):async function(){try{let{default:a,Database:t}=await e.A(61419);await a(),window.Database=t,C(!0)}catch(e){console.error("Failed to initialize WASM:",e)}}()},[]),(0,s.useEffect)(()=>{N&&e();async function e(){try{let e=window.Database;if(e&&e.getAllDatabases){let a=await e.getAllDatabases();m(a)}}catch(e){console.error("Failed to load databases:",e)}}},[N]);let M=async()=>{if(!u||!x)return void w("Please select both source and target databases");if(u===x)return void f({tablesAdded:[],tablesRemoved:[],tablesModified:[],indexesAdded:[],indexesRemoved:[]});b(!0),w(null),f(null);try{let e=window.Database;if(!e)throw Error("Database API not available");let a=await e.newDatabase(u),t=await e.newDatabase(x),s=await a.execute("SELECT name, sql FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"),r=await t.execute("SELECT name, sql FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name"),l=await a.execute("SELECT name, sql FROM sqlite_master WHERE type='index' AND name NOT LIKE 'sqlite_%' ORDER BY name"),d=await t.execute("SELECT name, sql FROM sqlite_master WHERE type='index' AND name NOT LIKE 'sqlite_%' ORDER BY name"),n=new Set(s.rows.map(e=>e.values[0].value)),i=new Set(r.rows.map(e=>e.values[0].value)),o=new Set(l.rows.map(e=>e.values[0].value)),c=new Set(d.rows.map(e=>e.values[0].value)),m=Array.from(i).filter(e=>!n.has(e)),h=Array.from(n).filter(e=>!i.has(e)),g=Array.from(c).filter(e=>!o.has(e)),p=Array.from(o).filter(e=>!c.has(e)),v=[];for(let e of Array.from(n).filter(e=>i.has(e)))try{let s=await a.execute(`PRAGMA table_info(${e})`),r=await t.execute(`PRAGMA table_info(${e})`),l=new Set(s.rows.map(e=>e.values[1].value)),d=new Set(r.rows.map(e=>e.values[1].value)),n=Array.from(d).filter(e=>!l.has(e)),i=Array.from(l).filter(e=>!d.has(e));(n.length>0||i.length>0)&&v.push({name:e,columnsAdded:n,columnsRemoved:i,columnsModified:[]})}catch(a){console.error(`Error comparing table ${e}:`,a)}await a.close(),await t.close(),f({tablesAdded:m,tablesRemoved:h,tablesModified:v,indexesAdded:g,indexesRemoved:p})}catch(e){console.error("[SchemaDiff] Error comparing databases:",e),w(e.message||"Failed to compare databases")}finally{b(!1)}},O=p&&(p.tablesAdded.length>0||p.tablesRemoved.length>0||p.tablesModified.length>0||p.indexesAdded.length>0||p.indexesRemoved.length>0),L=async()=>{if(p&&O){$(!0);try{let e=window.Database;if(!e)throw Error("Database API not available");let a=await e.newDatabase(x),t=await e.newDatabase(u),s=[],r=[];for(let e of(s.push("-- Forward Migration"),s.push(`-- Migrate ${u} to ${x} schema`),s.push("-- Generated: "+new Date().toISOString()),s.push(""),s.push("BEGIN TRANSACTION;"),s.push(""),r.push("-- Rollback Migration"),r.push(`-- Rollback ${x} to ${u} schema`),r.push("-- Generated: "+new Date().toISOString()),r.push(""),r.push("BEGIN TRANSACTION;"),r.push(""),p.tablesAdded))try{let t=await a.execute(`SELECT sql FROM sqlite_master WHERE type='table' AND name='${e}'`);if(t.rows.length>0){let a=t.rows[0].values[0].value;s.push(`-- Add table: ${e}`),s.push(a+";"),s.push(""),r.push(`-- Remove table: ${e}`),r.push(`DROP TABLE IF EXISTS ${e};`),r.push("")}}catch(a){console.error(`Error getting CREATE statement for ${e}:`,a)}for(let e of p.tablesRemoved)try{let a=await t.execute(`SELECT sql FROM sqlite_master WHERE type='table' AND name='${e}'`);if(a.rows.length>0){let t=a.rows[0].values[0].value;s.push(`-- Remove table: ${e}`),s.push(`DROP TABLE IF EXISTS ${e};`),s.push(""),r.push(`-- Restore table: ${e}`),r.push(t+";"),r.push("")}}catch(a){console.error(`Error getting DROP statement for ${e}:`,a)}for(let e of p.tablesModified)try{let t=await a.execute(`PRAGMA table_info(${e.name})`);for(let a of e.columnsAdded){let l=t.rows.find(e=>e.values[1].value===a);if(l){let t=l.values[2].value,d=1===l.values[3].value,n=l.values[4].value,i=`ALTER TABLE ${e.name} ADD COLUMN ${a} ${t}`;d&&(i+=" NOT NULL"),null!==n&&(i+=` DEFAULT ${n}`),s.push(`-- Add column to ${e.name}`),s.push(i+";"),s.push(""),r.push("-- Note: SQLite DROP COLUMN requires table recreation"),r.push(`-- Column ${a} was added to ${e.name}`),r.push("")}}for(let a of e.columnsRemoved)s.push(`-- Note: Removing column ${a} from ${e.name}`),s.push("-- SQLite requires table recreation for column removal"),s.push("-- Consider manual migration or backup/restore"),s.push(""),r.push(`-- Note: Column ${a} was removed from ${e.name}`),r.push("-- Would require ALTER TABLE ADD COLUMN"),r.push("")}catch(a){console.error(`Error generating ALTER statements for ${e.name}:`,a)}for(let e of p.indexesAdded)try{let t=await a.execute(`SELECT sql FROM sqlite_master WHERE type='index' AND name='${e}'`);if(t.rows.length>0&&t.rows[0].values[0].value){let a=t.rows[0].values[0].value;s.push(`-- Add index: ${e}`),s.push(a+";"),s.push(""),r.push(`-- Remove index: ${e}`),r.push(`DROP INDEX IF EXISTS ${e};`),r.push("")}}catch(a){console.error(`Error getting CREATE INDEX for ${e}:`,a)}for(let e of p.indexesRemoved)try{let a=await t.execute(`SELECT sql FROM sqlite_master WHERE type='index' AND name='${e}'`);if(a.rows.length>0&&a.rows[0].values[0].value){let t=a.rows[0].values[0].value;s.push(`-- Remove index: ${e}`),s.push(`DROP INDEX IF EXISTS ${e};`),s.push(""),r.push(`-- Restore index: ${e}`),r.push(t+";"),r.push("")}}catch(a){console.error(`Error getting DROP INDEX for ${e}:`,a)}s.push("COMMIT;"),r.push("COMMIT;"),await a.close(),await t.close(),y(s.join("\n")),E(r.join("\n")),D(!0)}catch(e){console.error("[MigrationGenerator] Error generating migration:",e),w(e.message||"Failed to generate migration")}finally{$(!1)}}},_=(e,a)=>{let t=new Blob([e],{type:"text/plain"}),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)};return(0,a.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Schema Diff"}),(0,a.jsxs)(d.Card,{children:[(0,a.jsxs)(d.CardHeader,{children:[(0,a.jsx)(d.CardTitle,{children:"Compare Databases"}),(0,a.jsx)(d.CardDescription,{children:"Compare schema differences between two databases"})]}),(0,a.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"sourceDb",className:"text-sm font-medium",children:"Source Database"}),(0,a.jsxs)(n.Select,{value:u,onValueChange:h,children:[(0,a.jsx)(n.SelectTrigger,{id:"sourceDb",children:(0,a.jsx)(n.SelectValue,{placeholder:"Select source database"})}),(0,a.jsx)(n.SelectContent,{children:c.map(e=>(0,a.jsx)(n.SelectItem,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"targetDb",className:"text-sm font-medium",children:"Target Database"}),(0,a.jsxs)(n.Select,{value:x,onValueChange:g,children:[(0,a.jsx)(n.SelectTrigger,{id:"targetDb",children:(0,a.jsx)(n.SelectValue,{placeholder:"Select target database"})}),(0,a.jsx)(n.SelectContent,{children:c.map(e=>(0,a.jsx)(n.SelectItem,{value:e,children:e},e))})]})]})]}),(0,a.jsx)(l.Button,{id:"compareButton",onClick:M,disabled:!u||!x||v,children:v?"Comparing...":"Compare Databases"}),j&&(0,a.jsx)(i.Alert,{variant:"destructive",children:(0,a.jsx)(i.AlertDescription,{children:j})})]})]}),p&&!O&&(0,a.jsx)(d.Card,{children:(0,a.jsx)(d.CardContent,{className:"py-8",children:(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:"No differences found. The databases have identical schemas."})})}),p&&O&&(0,a.jsxs)("div",{className:"space-y-4","data-testid":"diff-summary",children:[(0,a.jsx)(d.Card,{children:(0,a.jsx)(d.CardContent,{className:"py-4",children:(0,a.jsx)(l.Button,{id:"generateMigrationButton",onClick:L,disabled:T,className:"w-full md:w-auto",children:T?"Generating...":"Generate Migration"})})}),S&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(d.Card,{children:[(0,a.jsxs)(d.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(d.CardTitle,{children:"Forward Migration SQL"}),(0,a.jsx)(l.Button,{id:"downloadForwardMigration",onClick:()=>{let e=new Date().toISOString().split("T")[0];_(R,`forward_migration_${e}.sql`)},variant:"outline",size:"sm",children:"Download Forward"})]}),(0,a.jsxs)(d.CardDescription,{children:["Apply these changes to migrate from ",u," to ",x]})]}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("pre",{id:"forwardMigrationSql","data-testid":"forward-migration",className:"p-4 bg-gray-50 rounded-lg overflow-x-auto text-sm font-mono whitespace-pre",children:R})})]}),(0,a.jsxs)(d.Card,{children:[(0,a.jsxs)(d.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(d.CardTitle,{children:"Rollback Migration SQL"}),(0,a.jsx)(l.Button,{id:"downloadRollbackMigration",onClick:()=>{let e=new Date().toISOString().split("T")[0];_(A,`rollback_migration_${e}.sql`)},variant:"outline",size:"sm",children:"Download Rollback"})]}),(0,a.jsxs)(d.CardDescription,{children:["Use this to revert the migration and restore ",u," schema"]})]}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("pre",{id:"rollbackMigrationSql","data-testid":"rollback-migration",className:"p-4 bg-gray-50 rounded-lg overflow-x-auto text-sm font-mono whitespace-pre",children:A})})]})]}),(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{children:"Difference Summary"})}),(0,a.jsxs)(d.CardContent,{className:"space-y-2",children:[p.tablesAdded.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(o.Badge,{variant:"outline",className:"bg-green-50 text-green-700",children:["+",p.tablesAdded.length]}),(0,a.jsxs)("span",{className:"text-sm",children:[1===p.tablesAdded.length?"table":"tables"," added"]})]}),p.tablesRemoved.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(o.Badge,{variant:"outline",className:"bg-red-50 text-red-700",children:["-",p.tablesRemoved.length]}),(0,a.jsxs)("span",{className:"text-sm",children:[1===p.tablesRemoved.length?"table":"tables"," removed"]})]}),p.tablesModified.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(o.Badge,{variant:"outline",className:"bg-yellow-50 text-yellow-700",children:["~",p.tablesModified.length]}),(0,a.jsxs)("span",{className:"text-sm",children:[1===p.tablesModified.length?"table":"tables"," modified"]})]}),p.indexesAdded.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(o.Badge,{variant:"outline",className:"bg-green-50 text-green-700",children:["+",p.indexesAdded.length]}),(0,a.jsxs)("span",{className:"text-sm",children:[1===p.indexesAdded.length?"index":"indexes"," added"]})]}),p.indexesRemoved.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(o.Badge,{variant:"outline",className:"bg-red-50 text-red-700",children:["-",p.indexesRemoved.length]}),(0,a.jsxs)("span",{className:"text-sm",children:[1===p.indexesRemoved.length?"index":"indexes"," removed"]})]})]})]}),p.tablesAdded.length>0&&(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-green-700",children:"Tables Added"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("div",{className:"space-y-2",children:p.tablesAdded.map(e=>(0,a.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded","data-diff":"added",children:(0,a.jsx)("span",{className:"font-mono text-sm",children:e})},e))})})]}),p.tablesRemoved.length>0&&(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-red-700",children:"Tables Removed"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("div",{className:"space-y-2",children:p.tablesRemoved.map(e=>(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded","data-diff":"removed",children:(0,a.jsx)("span",{className:"font-mono text-sm",children:e})},e))})})]}),p.tablesModified.length>0&&(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-yellow-700",children:"Tables Modified"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("div",{className:"space-y-4",children:p.tablesModified.map(e=>(0,a.jsxs)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded space-y-3","data-diff":"modified",children:[(0,a.jsx)("div",{className:"font-mono font-semibold",children:e.name}),e.columnsAdded.length>0&&(0,a.jsxs)("div",{className:"ml-4 space-y-1",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-green-700",children:"Columns Added:"}),e.columnsAdded.map(e=>(0,a.jsxs)("div",{className:"ml-4 text-sm font-mono text-green-600",children:["+ ",e]},e))]}),e.columnsRemoved.length>0&&(0,a.jsxs)("div",{className:"ml-4 space-y-1",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-red-700",children:"Columns Removed:"}),e.columnsRemoved.map(e=>(0,a.jsxs)("div",{className:"ml-4 text-sm font-mono text-red-600",children:["- ",e]},e))]})]},e.name))})})]}),p.indexesAdded.length>0&&(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-green-700",children:"Indexes Added"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("div",{className:"space-y-2",children:p.indexesAdded.map(e=>(0,a.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded","data-type":"index","data-diff":"added",children:(0,a.jsx)("span",{className:"font-mono text-sm",children:e})},e))})})]}),p.indexesRemoved.length>0&&(0,a.jsxs)(d.Card,{children:[(0,a.jsx)(d.CardHeader,{children:(0,a.jsx)(d.CardTitle,{className:"text-red-700",children:"Indexes Removed"})}),(0,a.jsx)(d.CardContent,{children:(0,a.jsx)("div",{className:"space-y-2",children:p.indexesRemoved.map(e=>(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded","data-type":"index","data-diff":"removed",children:(0,a.jsx)("span",{className:"font-mono text-sm",children:e})},e))})})]})]})]})}function m(){let e,s=(0,t.c)(1);return(0,r.useDatabaseStore)(u),s[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,a.jsx)(c,{}),s[0]=e):e=s[0],e}function u(e){return e.currentDbName}e.s(["default",()=>m])},61419,e=>{e.v(a=>Promise.all(["static/chunks/0d126131a3369877.js"].map(a=>e.l(a))).then(()=>a(4948)))}]);