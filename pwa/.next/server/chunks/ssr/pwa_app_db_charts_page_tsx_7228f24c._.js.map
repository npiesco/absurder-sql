{"version":3,"sources":["turbopack:///[project]/pwa/app/db/charts/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useDatabaseStore } from '@/lib/db/store';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport {\n  LineChart,\n  Line,\n  BarChart,\n  Bar,\n  PieChart,\n  Pie,\n  ScatterChart,\n  Scatter,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n  Cell,\n} from 'recharts';\nimport type { QueryResult } from '@/lib/db/client';\nimport { Textarea } from '@/components/ui/textarea';\nimport html2canvas from 'html2canvas';\n\n// Define ColumnValue type based on WASM package\ntype ColumnValue = \n  | { type: \"Null\" } \n  | { type: \"Integer\"; value: number } \n  | { type: \"Real\"; value: number } \n  | { type: \"Text\"; value: string } \n  | { type: \"Blob\"; value: number[] } \n  | { type: \"Date\"; value: number } \n  | { type: \"BigInt\"; value: string };\n\n// Helper to safely extract value from ColumnValue\nconst getValue = (col: ColumnValue): any => {\n  if (col.type === 'Null') return null;\n  return (col as any).value;\n};\n\ntype ChartType = 'line' | 'bar' | 'pie' | 'scatter';\n\nconst COLORS = ['#2563eb', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];\n\nfunction ChartBuilderContent() {\n  const { db } = useDatabaseStore();\n  const currentDbName = useDatabaseStore((state) => state.currentDbName);\n\n  const [sql, setSql] = useState('SELECT * FROM your_table');\n  const [queryResults, setQueryResults] = useState<QueryResult | null>(null);\n  const [queryError, setQueryError] = useState<string | null>(null);\n  const [isExecuting, setIsExecuting] = useState(false);\n\n  const [chartType, setChartType] = useState<ChartType>('line');\n  const [chartTitle, setChartTitle] = useState('');\n  const [xAxisColumn, setXAxisColumn] = useState<string>('');\n  const [yAxisColumn, setYAxisColumn] = useState<string>('');\n\n  const [chartData, setChartData] = useState<any[]>([]);\n  const [availableColumns, setAvailableColumns] = useState<string[]>([]);\n\n  const chartContainerRef = useRef<HTMLDivElement>(null);\n\n  // Track window.testDb for E2E tests\n  const [windowTestDb, setWindowTestDb] = useState<any>(null);\n\n  // For E2E tests: check both Zustand store and window.testDb\n  const activeDb = db || windowTestDb;\n\n  // Initialize WASM and expose testDb globally for E2E tests\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    async function initializeWasm() {\n      try {\n        // Always expose Database class, even if db exists\n        const { Database } = await import('@npiesco/absurder-sql');\n        (window as any).Database = Database;\n\n        // If db exists from Zustand, expose it as testDb\n        if (db) {\n          (window as any).testDb = db;\n          return;\n        }\n\n        // Otherwise, initialize WASM\n        const init = (await import('@npiesco/absurder-sql')).default;\n        await init();\n      } catch (err: any) {\n        console.error('Failed to initialize WASM:', err);\n      }\n    }\n\n    initializeWasm();\n  }, [db]);\n\n  // Sync window.testDb to component state (for E2E tests)\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const checkTestDb = () => {\n      const testDb = (window as any).testDb;\n      if (testDb && !windowTestDb) {\n        console.log('[CHARTS] Detected window.testDb, updating state');\n        setWindowTestDb(testDb);\n      }\n    };\n\n    // Check immediately\n    checkTestDb();\n\n    // Also check periodically in case testDb is set after component mounts\n    const interval = setInterval(checkTestDb, 50);\n\n    return () => clearInterval(interval);\n  }, [windowTestDb]);\n\n  const executeQuery = async () => {\n    if (!activeDb) {\n      setQueryError('Database not initialized');\n      return;\n    }\n\n    if (!sql.trim()) {\n      setQueryError('Please enter a SQL query');\n      return;\n    }\n\n    setIsExecuting(true);\n    setQueryError(null);\n\n    try {\n      const result = await activeDb.execute(sql);\n      setQueryResults(result);\n      setQueryError(null);\n\n      // Extract column names\n      if (result.columns && result.columns.length > 0) {\n        const cols = result.columns;\n        setAvailableColumns(cols);\n        \n        // Auto-select first two columns if not already selected\n        if (!xAxisColumn && cols.length > 0) {\n          setXAxisColumn(cols[0]);\n        }\n        if (!yAxisColumn && cols.length > 1) {\n          setYAxisColumn(cols[1]);\n        } else if (!yAxisColumn && cols.length > 0) {\n          setYAxisColumn(cols[0]);\n        }\n\n        // Transform data for charting\n        const data = result.rows.map((row: any, index: number) => {\n          const rowData: any = { _index: index };\n          result.columns.forEach((col: string, colIndex: number) => {\n            const value = getValue(row.values[colIndex]);\n            rowData[col] = value;\n          });\n          return rowData;\n        });\n        setChartData(data);\n      } else {\n        setChartData([]);\n        setAvailableColumns([]);\n      }\n    } catch (err) {\n      console.error('Query execution error:', err);\n      setQueryError(`Query failed: ${String(err)}`);\n      setQueryResults(null);\n      setChartData([]);\n    } finally {\n      setIsExecuting(false);\n    }\n  };\n\n  const exportToPNG = async () => {\n    if (!chartContainerRef.current) {\n      console.error('[PNG Export] Chart container ref not found');\n      return;\n    }\n    \n    try {\n      // Find the SVG element directly\n      const svgElement = chartContainerRef.current.querySelector('svg');\n      if (!svgElement) return;\n      \n      // Get SVG dimensions\n      const svgRect = svgElement.getBoundingClientRect();\n      const canvas = document.createElement('canvas');\n      canvas.width = svgRect.width * 2; // 2x for better quality\n      canvas.height = svgRect.height * 2;\n      \n      const ctx = canvas.getContext('2d');\n      if (!ctx) return;\n      \n      // Fill white background\n      ctx.fillStyle = '#ffffff';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      \n      // Convert SVG to data URL\n      const svgData = new XMLSerializer().serializeToString(svgElement);\n      const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\n      const url = URL.createObjectURL(svgBlob);\n      \n      // Load SVG as image and draw to canvas\n      const img = new Image();\n      img.onload = () => {\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n        URL.revokeObjectURL(url);\n        \n        // Download PNG\n        const dataUrl = canvas.toDataURL('image/png');\n        const link = document.createElement('a');\n        const filename = chartTitle \n          ? `${chartTitle.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_chart.png`\n          : 'chart.png';\n        link.download = filename;\n        link.href = dataUrl;\n        link.click();\n      };\n      img.onerror = () => {\n        URL.revokeObjectURL(url);\n      };\n      img.src = url;\n    } catch (err) {\n      console.error('PNG export error:', err);\n    }\n  };\n\n  const exportToSVG = () => {\n    if (!chartContainerRef.current) return;\n    \n    try {\n      const svgElement = chartContainerRef.current.querySelector('svg');\n      if (!svgElement) return;\n      \n      const svgData = new XMLSerializer().serializeToString(svgElement);\n      const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\n      const svgUrl = URL.createObjectURL(svgBlob);\n      \n      const link = document.createElement('a');\n      const filename = chartTitle \n        ? `${chartTitle.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_chart.svg`\n        : 'chart.svg';\n      link.download = filename;\n      link.href = svgUrl;\n      link.click();\n      \n      URL.revokeObjectURL(svgUrl);\n    } catch (err) {\n      console.error('SVG export error:', err);\n    }\n  };\n\n  const exportToCSV = () => {\n    if (!chartData || chartData.length === 0) return;\n    \n    try {\n      // Get all keys from first row (excluding _index)\n      const keys = Object.keys(chartData[0]).filter(k => k !== '_index');\n      \n      // Create CSV header\n      const csvLines: string[] = [keys.join(',')];\n      \n      // Add data rows\n      chartData.forEach(row => {\n        const values = keys.map(key => {\n          const value = row[key];\n          // Escape values containing commas or quotes\n          if (typeof value === 'string' && (value.includes(',') || value.includes('\"'))) {\n            return `\"${value.replace(/\"/g, '\"\"')}\"`;\n          }\n          return value;\n        });\n        csvLines.push(values.join(','));\n      });\n      \n      const csvContent = csvLines.join('\\n');\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n      const url = URL.createObjectURL(blob);\n      \n      const link = document.createElement('a');\n      const filename = chartTitle \n        ? `${chartTitle.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_data.csv`\n        : 'chart_data.csv';\n      link.download = filename;\n      link.href = url;\n      link.click();\n      \n      URL.revokeObjectURL(url);\n    } catch (err) {\n      console.error('CSV export error:', err);\n    }\n  };\n\n  const renderChart = () => {\n    if (!chartData || chartData.length === 0) {\n      return (\n        <div className=\"flex items-center justify-center h-64 text-muted-foreground\">\n          <p>No data to display. Execute a query to see results.</p>\n        </div>\n      );\n    }\n\n    const chartProps = {\n      data: chartData,\n      width: 600,\n      height: 400,\n    };\n\n    switch (chartType) {\n      case 'line':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <LineChart data={chartData}>\n              <CartesianGrid strokeDasharray=\"3 3\" />\n              <XAxis dataKey={xAxisColumn || availableColumns[0]} />\n              <YAxis />\n              <Tooltip />\n              <Legend />\n              <Line type=\"monotone\" dataKey={yAxisColumn || availableColumns[1]} stroke=\"#2563eb\" strokeWidth={2} />\n            </LineChart>\n          </ResponsiveContainer>\n        );\n\n      case 'bar':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <BarChart data={chartData}>\n              <CartesianGrid strokeDasharray=\"3 3\" />\n              <XAxis dataKey={xAxisColumn || availableColumns[0]} />\n              <YAxis />\n              <Tooltip />\n              <Legend />\n              <Bar dataKey={yAxisColumn || availableColumns[1]} fill=\"#2563eb\" />\n            </BarChart>\n          </ResponsiveContainer>\n        );\n\n      case 'pie':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <PieChart>\n              <Pie\n                data={chartData}\n                dataKey={yAxisColumn || availableColumns[1]}\n                nameKey={xAxisColumn || availableColumns[0]}\n                cx=\"50%\"\n                cy=\"50%\"\n                outerRadius={120}\n                label\n              >\n                {chartData.map((entry, index) => (\n                  <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                ))}\n              </Pie>\n              <Tooltip />\n              <Legend />\n            </PieChart>\n          </ResponsiveContainer>\n        );\n\n      case 'scatter':\n        return (\n          <ResponsiveContainer width=\"100%\" height={400}>\n            <ScatterChart>\n              <CartesianGrid strokeDasharray=\"3 3\" />\n              <XAxis dataKey={xAxisColumn || availableColumns[0]} />\n              <YAxis dataKey={yAxisColumn || availableColumns[1]} />\n              <Tooltip cursor={{ strokeDasharray: '3 3' }} />\n              <Legend />\n              <Scatter name=\"Data Points\" data={chartData} fill=\"#2563eb\" />\n            </ScatterChart>\n          </ResponsiveContainer>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  if (!currentDbName || !activeDb) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <p>No database selected. Please create or load a database first.</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Chart Builder</CardTitle>\n          <CardDescription>\n            Create interactive charts from your SQL queries\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"sqlQuery\">SQL Query</Label>\n            <Textarea\n              id=\"sqlQuery\"\n              placeholder=\"SELECT column1, column2 FROM your_table\"\n              value={sql}\n              onChange={(e) => setSql(e.target.value)}\n              rows={4}\n              className=\"font-mono text-sm\"\n            />\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button\n              onClick={executeQuery}\n              disabled={!sql.trim() || isExecuting}\n            >\n              {isExecuting ? 'Executing...' : 'Execute'}\n            </Button>\n            {queryResults && (\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setQueryResults(null);\n                  setChartData([]);\n                  setQueryError(null);\n                }}\n              >\n                Clear\n              </Button>\n            )}\n          </div>\n\n          {queryError && (\n            <div className=\"text-red-600 text-sm\">\n              {queryError}\n            </div>\n          )}\n\n          {queryResults && queryResults.rows.length === 0 && (\n            <div className=\"text-muted-foreground text-sm\">\n              No results returned from query\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {queryResults && chartData.length > 0 && (\n        <>\n          <Card>\n            <CardHeader>\n              <CardTitle>Chart Configuration</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"chartType\">Chart Type</Label>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant={chartType === 'line' ? 'default' : 'outline'}\n                      onClick={() => setChartType('line')}\n                      data-testid=\"chart-type-line\"\n                    >\n                      Line\n                    </Button>\n                    <Button\n                      variant={chartType === 'bar' ? 'default' : 'outline'}\n                      onClick={() => setChartType('bar')}\n                      data-testid=\"chart-type-bar\"\n                    >\n                      Bar\n                    </Button>\n                    <Button\n                      variant={chartType === 'pie' ? 'default' : 'outline'}\n                      onClick={() => setChartType('pie')}\n                      data-testid=\"chart-type-pie\"\n                    >\n                      Pie\n                    </Button>\n                    <Button\n                      variant={chartType === 'scatter' ? 'default' : 'outline'}\n                      onClick={() => setChartType('scatter')}\n                      data-testid=\"chart-type-scatter\"\n                    >\n                      Scatter\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"chartTitle\">Chart Title</Label>\n                  <Input\n                    id=\"chartTitle\"\n                    placeholder=\"Enter chart title\"\n                    value={chartTitle}\n                    onChange={(e) => setChartTitle(e.target.value)}\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"xAxis\">X-Axis Column</Label>\n                  <Select value={xAxisColumn} onValueChange={setXAxisColumn}>\n                    <SelectTrigger id=\"xAxis\" data-testid=\"x-axis-selector\">\n                      <SelectValue placeholder=\"Select column\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {availableColumns.map((col) => (\n                        <SelectItem key={col} value={col}>\n                          {col}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"yAxis\">Y-Axis Column</Label>\n                  <Select value={yAxisColumn} onValueChange={setYAxisColumn}>\n                    <SelectTrigger id=\"yAxis\" data-testid=\"y-axis-selector\">\n                      <SelectValue placeholder=\"Select column\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {availableColumns.map((col) => (\n                        <SelectItem key={col} value={col}>\n                          {col}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>{chartTitle || 'Chart Preview'}</CardTitle>\n              <CardDescription>\n                <div className=\"flex gap-2 mt-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={exportToPNG}\n                    data-testid=\"export-png\"\n                  >\n                    Export PNG\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={exportToSVG}\n                    data-testid=\"export-svg\"\n                  >\n                    Export SVG\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={exportToCSV}\n                    data-testid=\"export-csv\"\n                  >\n                    Download CSV\n                  </Button>\n                </div>\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div \n                data-testid=\"chart-preview\" \n                ref={chartContainerRef}\n                style={{ backgroundColor: '#ffffff', padding: '1rem' }}\n              >\n                {renderChart()}\n              </div>\n            </CardContent>\n          </Card>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function ChartBuilderPage() {\n  const currentDbName = useDatabaseStore((state) => state.currentDbName);\n  \n  return <ChartBuilderContent />;\n}\n"],"names":[],"mappings":"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"}