module.exports=[22367,(a,b,c)=>{"use strict";b.exports=a.r(76686).vendored["react-ssr"].ReactJsxRuntime},31442,(a,b,c)=>{"use strict";b.exports=a.r(76686).vendored["react-ssr"].ReactDOM},8840,a=>{"use strict";var b=a.i(22367),c=a.i(97863),d=a.i(23105),e=a.i(57372),f=a.i(45061),g=a.i(88762);function h(){let{db:h,setDb:i,currentDbName:j,setCurrentDbName:k}=(0,d.useDatabaseStore)(),[l,m]=(0,c.useState)(null),n=h||l,[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(!1),G=(0,c.useRef)(null);(0,c.useEffect)(()=>{},[h]),(0,c.useEffect)(()=>{},[l]),(0,c.useEffect)(()=>{n&&H()},[n]);let H=async()=>{if(n){v(!0),x("");try{let a=(await h.execute("SELECT name FROM sqlite_master WHERE type='table' AND name NOT LIKE 'sqlite_%' ORDER BY name")).rows.map(a=>a.values[0].value),b=[],c=[];for(let d=0;d<a.length;d++){let e=a[d],f=(await h.execute(`PRAGMA table_info(${e})`)).rows.length;for(let a of(await h.execute(`PRAGMA foreign_key_list(${e})`)).rows){let b=a.values[2].value,d=a.values[3].value,f=a.values[4].value;c.push({from:e,to:b,fromColumn:d,toColumn:f})}let g=Math.ceil(Math.sqrt(a.length)),i=Math.floor(d/g),j=d%g;b.push({name:e,columnCount:f,x:50+250*j,y:50+150*i})}p(b),r(c)}catch(a){console.error("[DiagramPage] Error loading diagram:",a),x(`Failed to load diagram: ${a}`)}finally{v(!1)}}};(0,c.useEffect)(()=>{},[h]);let I=async a=>{if(n)try{let b=(await h.execute(`PRAGMA table_info(${a})`)).rows.map(a=>({name:a.values[1].value,type:a.values[2].value,notnull:1===a.values[3].value,dflt_value:a.values[4].value,pk:1===a.values[5].value}));D(b),B(a)}catch(a){console.error("[DiagramPage] Error loading table details:",a)}},J=async()=>{if(G.current)try{console.log("[DiagramPage] Starting PNG export");let b=(await a.A(83003)).default;console.log("[DiagramPage] html2canvas loaded, rendering canvas");let c=await b(G.current,{backgroundColor:"#ffffff",logging:!1,scale:2});console.log("[DiagramPage] Canvas rendered, creating download");let d=c.toDataURL("image/png"),e=document.createElement("a");e.download=`er-diagram-${Date.now()}.png`,e.href=d,document.body.appendChild(e),e.click(),document.body.removeChild(e),console.log("[DiagramPage] PNG export complete")}catch(a){console.error("[DiagramPage] Error exporting PNG:",a),x(`Failed to export PNG: ${a}`)}};return s?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)("p",{children:"Initializing database..."})}):(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"ER Diagram"}),(0,b.jsxs)("p",{className:"text-muted-foreground",children:[o.length," ",1===o.length?"table":"tables",", ",q.length," ",1===q.length?"relationship":"relationships"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{z(a=>Math.max(a-.2,.2))},children:"Zoom Out"}),(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{z(1)},children:"Reset Zoom"}),(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{z(a=>Math.min(a+.2,3))},children:"Zoom In"}),(0,b.jsx)(e.Button,{onClick:()=>F(!0),children:"Export"})]})]}),w&&(0,b.jsx)("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded","data-testid":"error-message",children:w}),0===o.length?(0,b.jsx)(f.Card,{className:"p-8 text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No tables found in the database. Create tables to see the ER diagram."})}):(0,b.jsx)("div",{className:"border rounded-lg overflow-auto",style:{height:"calc(100vh - 250px)"},children:(0,b.jsxs)("div",{ref:G,"data-testid":"diagram-container",style:{transform:`scale(${y})`,transformOrigin:"top left",transition:"transform 0.2s",width:"1200px",height:"800px",position:"relative",padding:"20px"},children:[(0,b.jsxs)("svg",{width:"1200",height:"800",style:{position:"absolute",top:0,left:0,pointerEvents:"none",overflow:"visible",visibility:"visible"},viewBox:"0 0 1200 800",children:[(0,b.jsx)("defs",{children:(0,b.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"10",refX:"9",refY:"3",orient:"auto",children:(0,b.jsx)("polygon",{points:"0 0, 10 3, 0 6",fill:"#666"})})}),q.map((a,c)=>{let d=o.find(b=>b.name===a.from),e=o.find(b=>b.name===a.to);return d&&e?(0,b.jsx)("line",{"data-edge-type":"foreign-key","data-fk-edge":`${a.from}->${a.to}`,x1:d.x+100,y1:d.y+60,x2:e.x+100,y2:e.y+60,stroke:"#666",strokeWidth:"2",markerEnd:"url(#arrowhead)",style:{visibility:"visible",display:"inline"}},c):null})]}),o.map(a=>(0,b.jsxs)("div",{"data-node-type":"table","data-table-node":a.name,onClick:()=>I(a.name),style:{position:"absolute",left:a.x,top:a.y,width:"200px",cursor:"pointer"},className:"bg-white border-2 border-gray-300 rounded-lg p-4 shadow-md hover:shadow-lg transition-shadow",children:[(0,b.jsx)("div",{className:"font-bold text-center",children:a.name}),(0,b.jsxs)("div",{className:"text-sm text-gray-500 text-center mt-1",children:[a.columnCount," columns"]})]},a.name))]})}),(0,b.jsx)(g.Dialog,{open:null!==A,onOpenChange:a=>!a&&B(null),children:(0,b.jsxs)(g.DialogContent,{children:[(0,b.jsxs)(g.DialogHeader,{children:[(0,b.jsx)(g.DialogTitle,{children:A}),(0,b.jsx)(g.DialogDescription,{children:"Table structure and columns"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Columns:"}),(0,b.jsx)("div",{className:"border rounded",children:C.map((a,c)=>(0,b.jsxs)("div",{className:"px-3 py-2 border-b last:border-b-0",children:[(0,b.jsx)("span",{className:"font-mono font-semibold",children:a.name}),(0,b.jsxs)("span",{className:"text-gray-500 ml-2",children:["(",a.type,")"]}),a.pk&&(0,b.jsx)("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"PK"}),a.notnull&&(0,b.jsx)("span",{className:"ml-1 text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded",children:"NOT NULL"})]},c))})]}),(0,b.jsx)(g.DialogFooter,{children:(0,b.jsx)(e.Button,{onClick:()=>B(null),children:"Close"})})]})}),(0,b.jsx)(g.Dialog,{open:E,onOpenChange:F,children:(0,b.jsxs)(g.DialogContent,{children:[(0,b.jsxs)(g.DialogHeader,{children:[(0,b.jsx)(g.DialogTitle,{children:"Export Diagram"}),(0,b.jsx)(g.DialogDescription,{children:"Choose export format"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(e.Button,{className:"w-full",onClick:()=>{J(),F(!1)},children:"Export as PNG"}),(0,b.jsx)(e.Button,{className:"w-full",variant:"outline",onClick:()=>{if(G.current)try{console.log("[DiagramPage] Starting SVG export");let a=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="800">
  <style>
    .table-node { fill: white; stroke: #ccc; stroke-width: 2; }
    .table-text { font-family: Arial; font-size: 14px; }
    .edge { stroke: #666; stroke-width: 2; marker-end: url(#arrowhead); }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>
`;q.forEach(b=>{let c=o.find(a=>a.name===b.from),d=o.find(a=>a.name===b.to);c&&d&&(a+=`  <line class="edge" x1="${c.x+100}" y1="${c.y+60}" x2="${d.x+100}" y2="${d.y+60}" />
`)}),o.forEach(b=>{a+=`  <rect class="table-node" x="${b.x}" y="${b.y}" width="200" height="80" rx="5" />
  <text class="table-text" x="${b.x+100}" y="${b.y+35}" text-anchor="middle" font-weight="bold">${b.name}</text>
  <text class="table-text" x="${b.x+100}" y="${b.y+55}" text-anchor="middle" font-size="12">${b.columnCount} columns</text>
`}),a+="</svg>",console.log("[DiagramPage] SVG content created, creating download");let b=new Blob([a],{type:"image/svg+xml"}),c=URL.createObjectURL(b),d=document.createElement("a");d.download=`er-diagram-${Date.now()}.svg`,d.href=c,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c),console.log("[DiagramPage] SVG export complete")}catch(a){console.error("[DiagramPage] Error exporting SVG:",a),x(`Failed to export SVG: ${a}`)}F(!1)},children:"Export as SVG"})]}),(0,b.jsx)(g.DialogFooter,{children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>F(!1),children:"Cancel"})})]})})]})}a.s(["default",()=>h])},85002,a=>{a.v(b=>Promise.all(["server/chunks/ssr/7dc3a_@npiesco_absurder-sql_absurder_sql_bg_wasm_8664c6f1._.js","server/chunks/ssr/7dc3a_@npiesco_absurder-sql_absurder_sql_1f32a207.js"].map(b=>a.l(b))).then(()=>b(69732)))},83003,a=>{a.v(b=>Promise.all(["server/chunks/ssr/7dc3a_html2canvas_dist_html2canvas_esm_22a9a4fc.js"].map(b=>a.l(b))).then(()=>b(85838)))}];

//# sourceMappingURL=pwa_ea8ea716._.js.map