module.exports=[31202,a=>{"use strict";var b=a.i(22367),c=a.i(97863),d=a.i(23105),e=a.i(57372),f=a.i(45061),g=a.i(5193),h=a.i(2719),i=a.i(41313),j=a.i(88572),k=a.i(11341),l=a.i(11519),m=a.i(78384),n=a.i(21117),o=a.i(57642),p=a.i(65619),q=a.i(38158),r=a.i(62049),s=a.i(63080),t=a.i(35375),u=a.i(60138),v=a.i(25755),w=a.i(62436),x=a.i(2909),y=a.i(28927);let z=["#2563eb","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6","#f97316"];function A(){let{db:a}=(0,d.useDatabaseStore)(),A=(0,d.useDatabaseStore)(a=>a.currentDbName),[B,C]=(0,c.useState)("SELECT * FROM your_table"),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)("line"),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)([]),[T,U]=(0,c.useState)([]),V=(0,c.useRef)(null),[W,X]=(0,c.useState)(null),Y=a||W;(0,c.useEffect)(()=>{},[a]),(0,c.useEffect)(()=>{},[W]);let Z=async()=>{if(!Y)return void G("Database not initialized");if(!B.trim())return void G("Please enter a SQL query");I(!0),G(null);try{let a=await Y.execute(B);if(E(a),G(null),a.columns&&a.columns.length>0){let b=a.columns;U(b),!N&&b.length>0&&O(b[0]),!P&&b.length>1?Q(b[1]):!P&&b.length>0&&Q(b[0]);let c=a.rows.map((b,c)=>{let d={_index:c};return a.columns.forEach((a,c)=>{var e;let f=(e=b.values[c],"Null"===e.type?null:e.value);d[a]=f}),d});S(c)}else S([]),U([])}catch(a){console.error("Query execution error:",a),G(`Query failed: ${String(a)}`),E(null),S([])}finally{I(!1)}},$=async()=>{if(!V.current)return void console.error("[PNG Export] Chart container ref not found");try{let a=V.current.querySelector("svg");if(!a)return;let b=a.getBoundingClientRect(),c=document.createElement("canvas");c.width=2*b.width,c.height=2*b.height;let d=c.getContext("2d");if(!d)return;d.fillStyle="#ffffff",d.fillRect(0,0,c.width,c.height);let e=new XMLSerializer().serializeToString(a),f=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),g=URL.createObjectURL(f),h=new Image;h.onload=()=>{d.drawImage(h,0,0,c.width,c.height),URL.revokeObjectURL(g);let a=c.toDataURL("image/png"),b=document.createElement("a");b.download=L?`${L.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_chart.png`:"chart.png",b.href=a,b.click()},h.onerror=()=>{URL.revokeObjectURL(g)},h.src=g}catch(a){console.error("PNG export error:",a)}};return A&&Y?(0,b.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:"Chart Builder"}),(0,b.jsx)(f.CardDescription,{children:"Create interactive charts from your SQL queries"})]}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"sqlQuery",children:"SQL Query"}),(0,b.jsx)(y.Textarea,{id:"sqlQuery",placeholder:"SELECT column1, column2 FROM your_table",value:B,onChange:a=>C(a.target.value),rows:4,className:"font-mono text-sm"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{onClick:Z,disabled:!B.trim()||H,children:H?"Executing...":"Execute"}),D&&(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{E(null),S([]),G(null)},children:"Clear"})]}),F&&(0,b.jsx)("div",{className:"text-red-600 text-sm",children:F}),D&&0===D.rows.length&&(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:"No results returned from query"})]})]}),D&&R.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Chart Configuration"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"chartType",children:"Chart Type"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{variant:"line"===J?"default":"outline",onClick:()=>K("line"),"data-testid":"chart-type-line",children:"Line"}),(0,b.jsx)(e.Button,{variant:"bar"===J?"default":"outline",onClick:()=>K("bar"),"data-testid":"chart-type-bar",children:"Bar"}),(0,b.jsx)(e.Button,{variant:"pie"===J?"default":"outline",onClick:()=>K("pie"),"data-testid":"chart-type-pie",children:"Pie"}),(0,b.jsx)(e.Button,{variant:"scatter"===J?"default":"outline",onClick:()=>K("scatter"),"data-testid":"chart-type-scatter",children:"Scatter"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"chartTitle",children:"Chart Title"}),(0,b.jsx)(g.Input,{id:"chartTitle",placeholder:"Enter chart title",value:L,onChange:a=>M(a.target.value)})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"xAxis",children:"X-Axis Column"}),(0,b.jsxs)(i.Select,{value:N,onValueChange:O,children:[(0,b.jsx)(i.SelectTrigger,{id:"xAxis","data-testid":"x-axis-selector",children:(0,b.jsx)(i.SelectValue,{placeholder:"Select column"})}),(0,b.jsx)(i.SelectContent,{children:T.map(a=>(0,b.jsx)(i.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"yAxis",children:"Y-Axis Column"}),(0,b.jsxs)(i.Select,{value:P,onValueChange:Q,children:[(0,b.jsx)(i.SelectTrigger,{id:"yAxis","data-testid":"y-axis-selector",children:(0,b.jsx)(i.SelectValue,{placeholder:"Select column"})}),(0,b.jsx)(i.SelectContent,{children:T.map(a=>(0,b.jsx)(i.SelectItem,{value:a,children:a},a))})]})]})]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:L||"Chart Preview"}),(0,b.jsx)(f.CardDescription,{children:(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:$,"data-testid":"export-png",children:"Export PNG"}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>{if(V.current)try{let a=V.current.querySelector("svg");if(!a)return;let b=new XMLSerializer().serializeToString(a),c=new Blob([b],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(c),e=document.createElement("a");e.download=L?`${L.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_chart.svg`:"chart.svg",e.href=d,e.click(),URL.revokeObjectURL(d)}catch(a){console.error("SVG export error:",a)}},"data-testid":"export-svg",children:"Export SVG"}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>{if(R&&0!==R.length)try{let a=Object.keys(R[0]).filter(a=>"_index"!==a),b=[a.join(",")];R.forEach(c=>{let d=a.map(a=>{let b=c[a];return"string"==typeof b&&(b.includes(",")||b.includes('"'))?`"${b.replace(/"/g,'""')}"`:b});b.push(d.join(","))});let c=b.join("\n"),d=new Blob([c],{type:"text/csv;charset=utf-8;"}),e=URL.createObjectURL(d),f=document.createElement("a");f.download=L?`${L.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_data.csv`:"chart_data.csv",f.href=e,f.click(),URL.revokeObjectURL(e)}catch(a){console.error("CSV export error:",a)}},"data-testid":"export-csv",children:"Download CSV"})]})})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{"data-testid":"chart-preview",ref:V,style:{backgroundColor:"#ffffff",padding:"1rem"},children:(()=>{if(!R||0===R.length)return(0,b.jsx)("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:(0,b.jsx)("p",{children:"No data to display. Execute a query to see results."})});switch(J){case"line":return(0,b.jsx)(w.ResponsiveContainer,{width:"100%",height:400,children:(0,b.jsxs)(j.LineChart,{data:R,children:[(0,b.jsx)(t.CartesianGrid,{strokeDasharray:"3 3"}),(0,b.jsx)(r.XAxis,{dataKey:N||T[0]}),(0,b.jsx)(s.YAxis,{}),(0,b.jsx)(u.Tooltip,{}),(0,b.jsx)(v.Legend,{}),(0,b.jsx)(k.Line,{type:"monotone",dataKey:P||T[1],stroke:"#2563eb",strokeWidth:2})]})});case"bar":return(0,b.jsx)(w.ResponsiveContainer,{width:"100%",height:400,children:(0,b.jsxs)(l.BarChart,{data:R,children:[(0,b.jsx)(t.CartesianGrid,{strokeDasharray:"3 3"}),(0,b.jsx)(r.XAxis,{dataKey:N||T[0]}),(0,b.jsx)(s.YAxis,{}),(0,b.jsx)(u.Tooltip,{}),(0,b.jsx)(v.Legend,{}),(0,b.jsx)(m.Bar,{dataKey:P||T[1],fill:"#2563eb"})]})});case"pie":return(0,b.jsx)(w.ResponsiveContainer,{width:"100%",height:400,children:(0,b.jsxs)(n.PieChart,{children:[(0,b.jsx)(o.Pie,{data:R,dataKey:P||T[1],nameKey:N||T[0],cx:"50%",cy:"50%",outerRadius:120,label:!0,children:R.map((a,c)=>(0,b.jsx)(x.Cell,{fill:z[c%z.length]},`cell-${c}`))}),(0,b.jsx)(u.Tooltip,{}),(0,b.jsx)(v.Legend,{})]})});case"scatter":return(0,b.jsx)(w.ResponsiveContainer,{width:"100%",height:400,children:(0,b.jsxs)(p.ScatterChart,{children:[(0,b.jsx)(t.CartesianGrid,{strokeDasharray:"3 3"}),(0,b.jsx)(r.XAxis,{dataKey:N||T[0]}),(0,b.jsx)(s.YAxis,{dataKey:P||T[1]}),(0,b.jsx)(u.Tooltip,{cursor:{strokeDasharray:"3 3"}}),(0,b.jsx)(v.Legend,{}),(0,b.jsx)(q.Scatter,{name:"Data Points",data:R,fill:"#2563eb"})]})});default:return null}})()})})]})]})]}):(0,b.jsx)("div",{className:"container mx-auto p-6",children:(0,b.jsx)(f.Card,{children:(0,b.jsx)(f.CardContent,{className:"pt-6",children:(0,b.jsx)("p",{children:"No database selected. Please create or load a database first."})})})})}function B(){return(0,d.useDatabaseStore)(a=>a.currentDbName),(0,b.jsx)(A,{})}a.s(["default",()=>B])}];

//# sourceMappingURL=pwa_app_db_charts_page_tsx_7228f24c._.js.map