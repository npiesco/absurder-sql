module.exports=[22367,(a,b,c)=>{"use strict";b.exports=a.r(76686).vendored["react-ssr"].ReactJsxRuntime},14400,a=>{a.v("/_next/static/media/absurder_sql_bg.4b006aa8.wasm")},17766,a=>{"use strict";var b=a.i(69732);class c{db=null;dbName=null;initialized=!1;async initialize(){if(!this.initialized)try{await (0,b.default)(),this.initialized=!0}catch(a){throw console.error("Failed to initialize WASM module:",a),Error(`WASM initialization failed: ${a}`)}}isInitialized(){return this.initialized}async open(a){if(await this.initialize(),this.db)throw Error("Database is already open. Close it first.");try{this.db=await b.Database.newDatabase(a),this.dbName=a,console.log(`DatabaseClient: Opened database "${a}"`)}catch(a){throw console.error("DatabaseClient: Failed to open database:",a),Error(`Failed to open database: ${a}`)}}async execute(a,b){if(!this.db)throw Error("Database not opened. Call open() first.");try{if(b&&b.length>0)return await this.db.executeWithParams(a,b);return await this.db.execute(a)}catch(a){throw console.error("Query execution failed:",a),Error(`Query failed: ${a}`)}}async export(){if(!this.db)throw Error("Database not opened. Call open() first.");try{let a=await this.db.exportToFile();return new Blob([a],{type:"application/x-sqlite3"})}catch(a){throw console.error("Database export failed:",a),Error(`Export failed: ${a}`)}}async import(a){if(!this.db||!this.dbName)throw Error("Database not opened. Call open() first to create initial database instance.");try{let c=await a.arrayBuffer();await this.db.importFromFile(new Uint8Array(c)),console.log(`Import complete, reopening database "${this.dbName}"...`),this.db=await b.Database.newDatabase(this.dbName),console.log("Database reopened after import")}catch(a){throw console.error("Database import failed:",a),Error(`Import failed: ${a}`)}}async sync(){if(!this.db)throw Error("Database not opened. Call open() first.");try{await this.db.sync()}catch(a){throw console.error("Database sync failed:",a),Error(`Sync failed: ${a}`)}}async close(){if(this.db)try{await this.db.close(),this.db=null,this.dbName=null}catch(a){throw console.error("Database close failed:",a),Error(`Close failed: ${a}`)}}isOpen(){return null!==this.db}getDatabaseName(){return this.dbName}async exportDatabase(){return this.export()}async importDatabase(a,c){await this.initialize(),this.db&&await this.close();try{this.db=await b.Database.newDatabase(a),this.dbName=a;let d=await c.arrayBuffer();await this.db.importFromFile(new Uint8Array(d)),console.log(`Import complete, reopening database "${a}"...`),this.db=await b.Database.newDatabase(a),console.log("Database reopened after import")}catch(a){throw console.error("Database import failed:",a),this.db=null,this.dbName=null,Error(`Import failed: ${a}`)}}async deleteDatabase(a){await this.initialize(),this.dbName===a&&this.db&&await this.close();try{let b=indexedDB.deleteDatabase(a);await new Promise((c,d)=>{b.onsuccess=()=>{console.log(`Deleted database "${a}"`),c()},b.onerror=()=>{d(Error(`Failed to delete database: ${b.error}`))},b.onblocked=()=>{console.warn(`Delete blocked for database "${a}". Close all connections first.`)}})}catch(b){throw console.error(`Failed to delete database "${a}":`,b),Error(`Delete failed: ${b}`)}}getDatabase(){return this.db}async isLeader(){if(!this.db)throw Error("Database not opened. Call open() first.");return await this.db.isLeader()}async waitForLeadership(){if(!this.db)throw Error("Database not opened. Call open() first.");return await this.db.waitForLeadership()}async requestLeadership(){if(!this.db)throw Error("Database not opened. Call open() first.");return await this.db.requestLeadership()}async allowNonLeaderWrites(a){if(!this.db)throw Error("Database not opened. Call open() first.");return await this.db.allowNonLeaderWrites(a)}}a.s(["DatabaseClient",()=>c])},21585,a=>{"use strict";var b=a.i(22367),c=a.i(97863),d=a.i(17766);let e=null;function f(){let{db:a,loading:f,error:g}=function(a){let[b,f]=(0,c.useState)(null),[g,h]=(0,c.useState)(!0),[i,j]=(0,c.useState)(null);return(0,c.useEffect)(()=>{let b=!0;return async function(){try{e||(e=new d.DatabaseClient),await e.open(a),b&&(f(e),h(!1))}catch(a){console.error("useDatabase error:",a),b&&(j(a),h(!1))}}(),()=>{b=!1}},[a]),{db:b,loading:g,error:i}}("hooks_test.db"),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),{execute:x,pending:y}=function(){let[a,b]=(0,c.useState)(!1),[d,f]=(0,c.useState)(null);return{execute:(0,c.useCallback)(async a=>{if(!e)throw Error("Database not initialized");b(!0),f(null);try{for(let b of(await e.execute("BEGIN TRANSACTION"),a))await e.execute(b.sql,b.params);await e.execute("COMMIT")}catch(a){console.error("Transaction error:",a);try{await e.execute("ROLLBACK")}catch(a){console.error("Rollback error:",a)}throw f(a),a}finally{b(!1)}},[]),pending:a,error:d}}(),{exportDb:z}=function(){let[a,b]=(0,c.useState)(!1),[d,f]=(0,c.useState)(null);return{exportDb:(0,c.useCallback)(async(a="database.db")=>{if(!e)throw Error("Database not initialized");b(!0),f(null);try{let b=await e.export(),c=URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=a,d.click(),URL.revokeObjectURL(c)}catch(a){throw console.error("Export error:",a),f(a),a}finally{b(!1)}},[]),loading:a,error:d}}(),{importDb:A}=function(){let[a,b]=(0,c.useState)(!1),[d,f]=(0,c.useState)(0),[g,h]=(0,c.useState)(null);return{importDb:(0,c.useCallback)(async a=>{if(!e)throw Error("Database not initialized");b(!0),f(0),h(null);try{f(50),await e.import(a),f(100)}catch(a){throw console.error("Import error:",a),h(a),a}finally{b(!1)}},[]),loading:a,progress:d,error:g}}();(0,c.useEffect)(()=>{i(a=>[...a,f])},[f]),(0,c.useEffect)(()=>{},[a,f,g,h,j,l,n,p,r,t,v]);let B=async()=>{if(a)try{m(!0),await a.execute("DROP TABLE IF EXISTS query_test"),await a.execute("CREATE TABLE query_test (id INTEGER, name TEXT)"),await a.execute("INSERT INTO query_test VALUES (?, ?)",[{type:"Integer",value:1},{type:"Text",value:"Test Data"}]);let b=await a.execute("SELECT * FROM query_test");k(b.rows),o(null)}catch(a){o(a)}finally{m(!1)}},C=async()=>{a&&(await B(),q(!0))},D=async()=>{try{await x([{sql:"DROP TABLE IF EXISTS transaction_test"},{sql:"CREATE TABLE transaction_test (id INTEGER, value TEXT)"},{sql:"INSERT INTO transaction_test VALUES (?, ?)",params:[{type:"Integer",value:1},{type:"Text",value:"Transaction Data"}]}]),s(!0)}catch(a){console.error("Transaction failed:",a)}},E=async()=>{try{await x([{sql:"DROP TABLE IF EXISTS rollback_test"},{sql:"CREATE TABLE rollback_test (id INTEGER)"},{sql:"INSERT INTO rollback_test VALUES (1)"},{sql:"INVALID SQL SYNTAX"}])}catch(a){u(!0)}},F=async()=>{await z("hooks_test.db")},G=async()=>{let a=window.realExportFile;if(a)try{await A(a),w(!0)}catch(a){console.error("Import failed:",a)}};return(0,b.jsxs)("div",{style:{padding:"20px",fontFamily:"system-ui"},children:[(0,b.jsx)("h1",{children:"Hooks Test Page"}),(0,b.jsx)("p",{id:"status",children:f?"Loading...":g?`Error: ${g.message}`:"Database ready"}),(0,b.jsxs)("div",{style:{marginTop:"20px"},children:[(0,b.jsx)("button",{id:"testUseQuery",onClick:B,disabled:!a,children:"Test useQuery"}),(0,b.jsx)("button",{id:"testUseQueryRefetch",onClick:C,disabled:!a,children:"Test useQuery Refetch"}),(0,b.jsx)("p",{id:"useQueryResult",children:l?"Loading query...":j?p?"Refetch complete":"useQuery complete":""})]}),(0,b.jsxs)("div",{style:{marginTop:"20px"},children:[(0,b.jsx)("button",{id:"testTransaction",onClick:D,disabled:!a||y,children:"Test Transaction"}),(0,b.jsx)("button",{id:"testTransactionRollback",onClick:E,disabled:!a||y,children:"Test Transaction Rollback"}),(0,b.jsx)("p",{id:"transactionResult",children:r?"Transaction complete":t?"Rollback successful":""})]}),(0,b.jsx)("div",{style:{marginTop:"20px"},children:(0,b.jsx)("button",{id:"testExport",onClick:F,disabled:!a,children:"Test Export"})}),(0,b.jsxs)("div",{style:{marginTop:"20px"},children:[(0,b.jsx)("button",{id:"testImport",onClick:G,disabled:!a,children:"Test Import"}),(0,b.jsx)("p",{id:"importResult",children:v?"Import complete":""})]})]})}a.s(["default",()=>f],21585)}];

//# sourceMappingURL=pwa_8c1a11d1._.js.map